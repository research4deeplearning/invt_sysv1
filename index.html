<!DOCTYPE html>
<html>
<head>
  <title>Inventory Manager</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .item-img { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; }
    .loading { opacity: 0.5; pointer-events: none; }
  </style>
</head>
<body class="p-4">

<div class="container">
  <h2>Inventory System</h2>
  
  <div class="card p-3 mb-4">
    <h5>Add New Item</h5>
    <form id="addForm">
      <div class="row g-2">
        <div class="col-md-4"><input type="text" id="newName" class="form-control" placeholder="Item Name" required></div>
        <div class="col-md-2"><input type="number" id="newQty" class="form-control" placeholder="Qty" required></div>
        <div class="col-md-4"><input type="file" id="newImage" class="form-control" accept="image/*"></div>
        <div class="col-md-2"><button type="submit" class="btn btn-primary w-100">Add</button></div>
      </div>
    </form>
  </div>

  <table class="table table-striped">
    <thead>
      <tr>
        <th>Image</th>
        <th>Name</th>
        <th>Qty</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="tableBody">
      </tbody>
  </table>
</div>

<script>
  // PASTE YOUR GOOGLE APPS SCRIPT WEB APP URL HERE
  const API_URL = 'https://script.google.com/macros/s/AKfycbywiWEPVbjoOwUu0CGV4nlatt4ROC3RapA2_FxXe-HkFDySZ56tGR5QxdDZg2BWfxDh/exec';

  // 1. Fetch and Display Data
  async function loadInventory() {
    const res = await fetch(API_URL);
    const data = await res.json();
    const tbody = document.getElementById('tableBody');
    tbody.innerHTML = '';
    
    data.forEach(item => {
      tbody.innerHTML += `
        <tr>
          <td><img src="${item.image || 'https://via.placeholder.com/50'}" class="item-img"></td>
          <td>${item.name}</td>
          <td>${item.qty}</td>
          <td>
            <button class="btn btn-sm btn-warning" onclick="updateItem('${item.id}', '${item.name}')">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="deleteItem('${item.id}')">Delete</button>
          </td>
        </tr>
      `;
    });
  }

  // 2. Create New Item
  document.getElementById('addForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    document.body.classList.add('loading'); // Simple loading state
    
    const name = document.getElementById('newName').value;
    const qty = document.getElementById('newQty').value;
    const fileInput = document.getElementById('newImage');
    
    let base64 = "";
    if (fileInput.files.length > 0) {
      base64 = await toBase64(fileInput.files[0]);
    }

    await fetch(API_URL, {
      method: 'POST',
      body: JSON.stringify({ action: 'create', name: name, qty: qty, image: base64 })
    });

    document.getElementById('addForm').reset();
    await loadInventory();
    document.body.classList.remove('loading');
  });

  // 3. Delete Item
  async function deleteItem(id) {
    if(!confirm("Are you sure?")) return;
    document.body.classList.add('loading');
    
    await fetch(API_URL, {
      method: 'POST',
      body: JSON.stringify({ action: 'delete', id: id })
    });
    
    await loadInventory();
    document.body.classList.remove('loading');
  }

  // Helper: Convert File to Base64
  const toBase64 = file => new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = () => resolve(reader.result);
      reader.onerror = error => reject(error);
  });

  // Initial Load
  loadInventory();
</script>

</body>
</html>
